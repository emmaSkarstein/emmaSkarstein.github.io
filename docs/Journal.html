<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Power usage analysis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Emma Skarstein</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Journal.html">Journal</a>
</li>
<li>
  <a href="Measurement_error_simulations.html">Measurement error simulations</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Power usage analysis</h1>

</div>


<p>Latest update: 25.01.2021</p>
<p>Welcome to my power usage project! Through the fantastic service <a href="https://www.elhub.no/">elhub</a> I have downloaded (and continue to download) monthly data sets that contain the hourly power usage in my appartment. I made an <a href="https://github.com/emmaSkarstein/power.usage.analysis">R-package</a> that contains all the data plus some useful functions. Here I will explore some visualisations of the data.</p>
<pre class="r"><code>library(power.usage.analysis)
library(ggplot2)
library(dplyr)</code></pre>
<pre class="r"><code>theme_set(theme_minimal())</code></pre>
<p>First, let us load the data and look at the structure of it.</p>
<pre class="r"><code>summary(power_data)</code></pre>
<pre><code>##      Fra                Til            KWH.60.Forbruk 
##  Length:17233       Length:17233       Min.   :0.000  
##  Class :character   Class :character   1st Qu.:0.286  
##  Mode  :character   Mode  :character   Median :0.886  
##                                        Mean   :1.220  
##                                        3rd Qu.:1.935  
##                                        Max.   :6.666  
##                                        NA&#39;s   :1      
##  X...code.to.prepare..DATASET..dataset.goes.here
##  Length:17233                                   
##  Class :character                               
##  Mode  :character                               
##                                                 
##                                                 
##                                                 
## </code></pre>
<p>This is already quite clean and nice, but we can do better. The function <code>clean_and_prepare</code> will add some new columns giving the year, month and weekday of each observation. In addition, we will format the date so R recognizes it as such.</p>
<pre class="r"><code>?clean_and_prepare</code></pre>
<pre class="r"><code>data &lt;- clean_and_prepare(power_data)</code></pre>
<pre class="r"><code>head(data)</code></pre>
<pre><code>##                      tid forbruk       date month weekday year
## ...1 2019-01-14 00:00:00   0.338 2019-01-13     1  Monday 2019
## ...2 2019-01-14 01:00:00   1.047 2019-01-14     1  Monday 2019
## ...3 2019-01-14 02:00:00   0.327 2019-01-14     1  Monday 2019
## ...4 2019-01-14 03:00:00   1.475 2019-01-14     1  Monday 2019
## ...5 2019-01-14 04:00:00   2.791 2019-01-14     1  Monday 2019
## ...6 2019-01-14 05:00:00   3.286 2019-01-14     1  Monday 2019</code></pre>
<p>Let’s try a simple plot of all the observations.</p>
<pre class="r"><code>p_simple &lt;- ggplot(data, aes(x = tid, y = forbruk)) + 
  geom_line() +
  ylab(&quot;Power usage&quot;) +
  xlab(&quot;&quot;)
p_simple</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>This is a mess. While we do see some general tendencies that are interesting (like maximum consumption varying seasonally), it is difficult to tell what is going on in all the noise. Maybe we can smooth it?</p>
<pre class="r"><code>p_simple + geom_smooth(color = &quot;darkorange&quot;)</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>This certainly looks smooth, but it’s still looking quite messy. I’ll try to add a better theme than the default.</p>
<p>—-add theme—-</p>
<p>—–also comment on missing values——</p>
<p>Another option is to try to group the data by some time period by summing or averaging it.</p>
<p>Let’s first see if there seems to be any difference in consumption for each weekday.</p>
<pre class="r"><code>ggplot(data, aes(x = weekday, y = forbruk)) +
  geom_violin(fill = &quot;darkorange&quot;) +
  geom_boxplot(width=0.1) +
  ylab(&quot;Power usage&quot;) +
  xlab(&quot;&quot;)</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Okay, it pretty much looks like the distribution is the same for each week day, maybe not surprisingly, although I might have expected the consumption to be a bit higher during the week-end. However, during most of 2020 we worked from home. Could it be that this is affecting the results, and that weekday differences were larger in 2019? Let’s investigate:</p>
<pre class="r"><code>ggplot(data, aes(x = weekday, y = forbruk, fill = year)) +
  geom_violin() +
  scale_fill_brewer(palette = &quot;Dark2&quot;) +
  ylab(&quot;Power usage&quot;) +
  xlab(&quot;&quot;)</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<pre class="r"><code>ggplot(data, aes(x = weekday, y = forbruk, fill = year)) +
  geom_boxplot() +
  scale_fill_brewer(palette = &quot;Dark2&quot;) +
  ylab(&quot;Power usage&quot;) +
  xlab(&quot;&quot;)</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
<pre class="r"><code>monthly_data &lt;- data %&gt;%
  group_by(month) %&gt;%
  summarise(sum_forb = sum(forbruk))

year_month &lt;- data %&gt;%
  group_by(month, year) %&gt;%
  summarise(sum_forb = sum(forbruk))</code></pre>
<pre class="r"><code>ggplot(year_month, aes(x = month, y = sum_forb)) +
  geom_col(aes(fill = year), color = &quot;black&quot;, position = &quot;dodge&quot;) +
  scale_fill_brewer(palette = &quot;Dark2&quot;) +
  ylab(&quot;Total power usage per month&quot;) +
  xlab(&quot;&quot;)</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
